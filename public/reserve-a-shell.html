<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<title>Shell Premium Parking Reservation</title>
  <link rel="icon" type="image/png" href="assets/Facebook Profile Picture.png" />
  <link rel="stylesheet" href="style.css" />
<style>
    #legend {
      display: flex;
      justify-content: center;
      gap: 1rem;
      align-items: center;
      font-family: 'Montserrat', sans-serif;
      font-size: 0.9rem;
      margin-top: 0.5rem;
      color: #2f6c5b;
    }
    #legend img {
      width: 16px;
      height: 16px;
      vertical-align: middle;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="logo-row">
      <img src="assets/SHELL_Stadium_Logo.png" alt="Shell Stadium Logo" class="shell-logo" />
      <img src="assets/Facebook Profile Picture.png" alt="OpenSpots Logo" class="center-logo" />
      <img src="assets/DY DASH LOGO.png" alt="Dynamo & Dash Logo" />
    </div>

    <h1>Reserve Your Premium Parking at Shell Energy Stadium</h1>

    <div id="event-display" class="event-display">Loading event details...</div>

    <div class="map-section">
      <h2>Select Your Parking Spot</h2>
      <p>Tap a green pin below to reserve your spot.</p>
      <div class="shell-map-wrapper venue-map-wrapper">
      <div id="map"></div>
      </div>
      <div id="legend">
        <div><img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16'><circle cx='8' cy='8' r='7' fill='%2332CD32' stroke='black' stroke-width='1'/></svg>"> Available</div>
        <div><img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16'><circle cx='8' cy='8' r='7' fill='%23d83b3b' stroke='black' stroke-width='1'/></svg>"> Reserved</div>
      </div>
      <div id="selectedSpot" class="selected-spot-display">No spot selected</div>
      <button id="reserveBtn" disabled>Reserve Parking & Continue</button>
    </div>

    <p class="disclaimer">
      Limited to 15 spots per event. Reserve now to guarantee your space.
    </p>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const eventName = urlParams.get("event") || "Shell Energy Stadium Event - Date TBD";
    document.getElementById("event-display").innerText = eventName;

    const selectedSpotDisplay = document.getElementById("selectedSpot");
    const reserveBtn = document.getElementById("reserveBtn");
    let selectedSpot = null;
    let activeInfo = null;

    const reservedSpots = ["A5", "A7", "A11"];
    const spots = [
      { id: "A1", lat: 29.75350967293998, lng: -95.35147235089146 },
      { id: "A2", lat: 29.753530782527122, lng: -95.35148993473362 },
      { id: "A3", lat: 29.753547626745746, lng: -95.35153152607492 },
      { id: "A4", lat: 29.753567314950107, lng: -95.35155054078098 },
      { id: "A5", lat: 29.753590727474172, lng: -95.35158190984451 },
      { id: "A6", lat: 29.753603397061564, lng: -95.35160530768009 },
      { id: "A7", lat: 29.75363053384316, lng: -95.35165470563292 },
      { id: "A8", lat: 29.753643422679872, lng: -95.35167850387077 },
      { id: "A9", lat: 29.753659664758207, lng: -95.35170708618243 },
      { id: "A10", lat: 29.75368905723394, lng: -95.35174723756917 },
      { id: "A11", lat: 29.75369853351272, lng: -95.35177268136299 },
      { id: "A12", lat: 29.753730074834447, lng: -95.35181499723821 },
      { id: "A13", lat: 29.753743966966347, lng: -95.3518402134391 },
      { id: "A14", lat: 29.753760652752117, lng: -95.3518719241529 },
      { id: "A15", lat: 29.753774099413892, lng: -95.35189315396008 },
    ];

    function distanceMiles(aLat,aLng,bLat,bLng){
      const R=3958.8;
      const dLat=(bLat-aLat)*Math.PI/180;
      const dLon=(bLng-aLng)*Math.PI/180;
      const a=Math.sin(dLat/2)**2+
              Math.cos(aLat*Math.PI/180)*Math.cos(bLat*Math.PI/180)*
              Math.sin(dLon/2)**2;
      return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
    }

    function niceMiles(mi){return mi>=10?mi.toFixed(1):mi>=1?mi.toFixed(2):Math.max(0.01,mi).toFixed(2);}

    function initMap(){
      navigator.geolocation.getCurrentPosition(
        pos=>renderMap({lat:pos.coords.latitude,lng:pos.coords.longitude}),
        ()=>renderMap({lat:29.75363,lng:-95.35170})
      );
    }

    function renderMap(userPos){
      const map=new google.maps.Map(document.getElementById("map"),{
        zoom:19,center:{lat:29.75363,lng:-95.35170},mapTypeId:"satellite",
        mapTypeControl:true,streetViewControl:false,fullscreenControl:true
      });

      // Blue "You are here" marker + pulse
      const userMarker=new google.maps.Marker({
        position:userPos,map,
        icon:{path:google.maps.SymbolPath.CIRCLE,fillColor:"#007bff",fillOpacity:0.9,strokeColor:"#fff",strokeWeight:2,scale:8}
      });
      const pulse=new google.maps.Circle({
        map,center:userPos,radius:0,strokeOpacity:0,fillColor:"#3b82f6",fillOpacity:0.35,clickable:false
      });
      let r=0,growing=true;
      setInterval(()=>{r=growing?r+6:0;pulse.setRadius(r);
        if(r>=120)growing=false;if(!growing&&r===0)growing=true;
      },60);

      spots.forEach(spot=>{
        const isReserved=reservedSpots.includes(spot.id);
        const dist=distanceMiles(userPos.lat,userPos.lng,spot.lat,spot.lng);
        const marker=new google.maps.Marker({
          position:{lat:spot.lat,lng:spot.lng},map,
          icon:{path:google.maps.SymbolPath.CIRCLE,fillColor:isReserved?"#d83b3b":"#32CD32",fillOpacity:1,strokeColor:"#fff",strokeWeight:2,scale:7}
        });

        const info=isReserved
          ? new google.maps.InfoWindow({
              content:`<div style='text-align:center;font-family:Montserrat;font-weight:600;'>Spot ${spot.id}<br><span style='color:#d83b3b;'>Reserved</span></div>`
            })
          : new google.maps.InfoWindow({
              content:`<div style='text-align:center;font-family:Montserrat;'><strong>Spot ${spot.id}</strong><br>Available<br>${niceMiles(dist)} mi away<br><br><button style='background:#2f6c5b;color:#fff;border:none;border-radius:6px;padding:6px 12px;cursor:pointer;font-weight:600;' onclick="selectSpot('${spot.id}')">Reserve</button></div>`
            });

        marker.addListener("click",()=>{if(activeInfo)activeInfo.close();info.open(map,marker);activeInfo=info;});
      });

      window.selectSpot=function(id){
        selectedSpot=id;
        selectedSpotDisplay.textContent=`You have selected spot ${id}`;
        reserveBtn.disabled=false;
        reserveBtn.classList.add("active");
      };

      reserveBtn.addEventListener("click",()=>{
        if(!selectedSpot)return;
        window.location.href=`details.html?spot=${selectedSpot}&event=${encodeURIComponent(eventName)}`;
      });
    }
  </script>

  <script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBnNTs3_DlvbUa4bNcZktr_gxdAj_AIZNs&callback=initMap"></script>
</body>
</html>
